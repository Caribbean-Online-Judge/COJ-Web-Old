problem.created.not.processed=select pid as pid from problem where event_created_processed=false and enable=true and disable_24h = false order by pid desc limit 1
contest.created.not.processed=select cid from contest where event_created_processed=false and enabled=true
contest.started.not.processed=select cid from contest where now() > initdate and event_started_processed=false and enabled=true
contest.ended.not.processed=select cid from contest where now() > enddate and event_ended_processed=false and enabled=true

mark.contest.created=update contest set event_created_processed=true where cid=?
mark.contest.started=update contest set event_started_processed=true where cid=?
mark.contest.ended=update contest set event_ended_processed=true where cid=?


#en uso
load.contest.awards.id=select aid from contest_awards where cid=?
delete.contest.awards=delete from contest_awards where cid=?
insert.contest.award=insert into contest_awards (aid,cid) values(?,?)
exclusive.award=select ? as cid,uid,nick,username,coalesce(a/a,0)+coalesce(b/b,0) +coalesce(c/c,0)+coalesce(d/d,0)+coalesce(e/e,0)+coalesce(f/f,0)+coalesce(g/g,0)+coalesce(h/h,0) +coalesce(i/i,0)+coalesce(j/j,0)+coalesce(k/k,0)+coalesce(l/l,0) as description, greatest(a,b,c,d,e,f,g,h,i,j,k,l) as greatest from (select uid,nick,username,case when a<> 100000000 and a = a_time then a else null end as a,case when b<> 100000000 and b = b_time then b else null end as b, case when c<> 100000000 and c = c_time then c else null end as c,case when d<> 100000000 and d = d_time then d else null end as d,case when e<> 100000000 and e = e_time then e else null end as e,case when f<> 100000000 and f = f_time then f else null end as f,case when g<> 100000000 and g = g_time then g else null end as g,case when h<> 100000000 and h = h_time then h else null end as h, case when i<> 100000000 and i = i_time then i else null end as i,case when j<> 100000000 and j = j_time then j else null end as j,case when k<> 100000000 and k = k_time then k else null end as k,case when l<> 100000000 and l = l_time then l else null end as l from (select users.uid,nick,username,case when sum(case when a_time <> 100000000 then 1 else 0 end) over () = 1 then min(a_time) over() else 100000000 end as a,case when sum(case when b_time <> 100000000 then 1 else 0 end) over () = 1 then min(b_time) over() else 100000000 end as b,case when sum(case when c_time <> 100000000 then 1 else 0 end) over () = 1 then min(c_time) over() else 100000000 end as c,case when sum(case when d_time <> 100000000 then 1 else 0 end) over () = 1 then min(d_time) over() else 100000000 end as d,case when sum(case when e_time <> 100000000 then 1 else 0 end) over () = 1 then min(e_time) over() else 100000000 end as e,case when sum(case when f_time <> 100000000 then 1 else 0 end) over () = 1 then min(f_time) over() else 100000000 end as f,case when sum(case when g_time <> 100000000 then 1 else 0 end) over () = 1 then min(g_time) over() else 100000000 end as g,case when sum(case when h_time <> 100000000 then 1 else 0 end) over () = 1 then min(h_time) over() else 100000000 end as h,case when sum(case when i_time <> 100000000 then 1 else 0 end) over () = 1 then min(i_time) over() else 100000000 end as i,case when sum(case when j_time <> 100000000 then 1 else 0 end) over () = 1 then min(j_time) over() else 100000000 end as j,case when sum(case when k_time <> 100000000 then 1 else 0 end) over () = 1 then min(k_time) over() else 100000000 end as k,case when sum(case when l_time <> 100000000 then 1 else 0 end) over () = 1 then min(l_time) over() else 100000000 end as l,a_time,b_time,c_time,d_time,e_time,f_time,g_time,h_time,i_time,j_time,k_time,l_time from users join user_contest uc using (uid) join contest on contest.cid = uc.cid where uc.cid=? and (contest.guest_group is null or groupd <> contest.guest_group) and contest.virtual=false ) tbl) tbl2 order by description desc,greatest asc limit 1
accurate.award=select ? as cid,nick,users.uid,username,(case when a_time<>100000000 and a_beforeac = 0 then 1 else 0 end +case when b_time<>100000000 and b_beforeac = 0 then 1 else 0 end +case when c_time<>100000000 and c_beforeac = 0 then 1 else 0 end +case when d_time<>100000000 and d_beforeac = 0 then 1 else 0 end +case when e_time<>100000000 and e_beforeac = 0 then 1 else 0 end +case when f_time<>100000000 and f_beforeac = 0 then 1 else 0 end +case when g_time<>100000000 and g_beforeac = 0 then 1 else 0 end +case when h_time<>100000000 and h_beforeac = 0 then 1 else 0 end +case when i_time<>100000000 and i_beforeac = 0 then 1 else 0 end +case when j_time<>100000000 and j_beforeac = 0 then 1 else 0 end +case when k_time<>100000000 and k_beforeac = 0 then 1 else 0 end +case when l_time<>100000000 and l_beforeac = 0 then 1 else 0 end ) as description,least(case when a_time<>100000000 and a_beforeac = 0 then a_time else 100000000 end,case when b_time<>100000000 and b_beforeac = 0 then b_time else 100000000 end,case when c_time<>100000000 and c_beforeac = 0 then c_time else 100000000 end,case when d_time<>100000000 and d_beforeac = 0 then d_time else 100000000 end,case when e_time<>100000000 and e_beforeac = 0 then e_time else 100000000 end,case when f_time<>100000000 and f_beforeac = 0 then f_time else 100000000 end,case when g_time<>100000000 and g_beforeac = 0 then g_time else 100000000 end,case when h_time<>100000000 and h_beforeac = 0 then h_time else 100000000 end,case when i_time<>100000000 and i_beforeac = 0 then i_time else 100000000 end,case when j_time<>100000000 and j_beforeac = 0 then j_time else 100000000 end,case when k_time<>100000000 and k_beforeac = 0 then k_time else 100000000 end,case when l_time<>100000000 and l_beforeac = 0 then l_time else 100000000 end ) as max from users join user_contest uc using (uid) join contest on contest.cid = uc.cid where uc.cid=? and (contest.guest_group is null or groupd <> contest.guest_group) and contest.virtual=false order by description desc,max asc limit 1
fast.award=select ? as cid,users.uid,nick,username,(case when a_time <>100000000 and min(a_time) over (order by a_time) = a_time then 1 else 0 end + case when b_time <>100000000 and min(b_time) over (order by b_time) = b_time then 1 else 0 end + case when c_time <>100000000 and min(c_time) over (order by c_time) = c_time then 1 else 0 end + case when d_time <>100000000 and min(d_time) over (order by d_time) = d_time then 1 else 0 end + case when e_time <>100000000 and min(e_time) over (order by e_time) = e_time then 1 else 0 end + case when f_time <>100000000 and min(f_time) over (order by f_time) = f_time then 1 else 0 end + case when g_time <>100000000 and min(g_time) over (order by g_time) = g_time then 1 else 0 end + case when h_time <>100000000 and min(h_time) over (order by h_time) = h_time then 1 else 0 end + case when i_time <>100000000 and min(i_time) over (order by i_time) = i_time then 1 else 0 end + case when j_time <>100000000 and min(j_time) over (order by j_time) = j_time then 1 else 0 end + case when k_time <>100000000 and min(k_time) over (order by k_time) = k_time then 1 else 0 end + case when l_time <>100000000 and min(l_time) over (order by l_time) = l_time then 1 else 0 end ) as description from users join user_contest uc using (uid) join contest on contest.cid = uc.cid where uc.cid=? and (contest.guest_group is null or groupd <> contest.guest_group) and contest.virtual=false order by description desc limit 1